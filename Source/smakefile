# pcre.library smake file

# Target
TARGET = pcre.library

# Compiler
C_COMPILER = sc

C_OPTIMIZE = OPTIMIZE OPTSCHEDULE NOOPTSIZE OPTTIME\
OPTINLINE OPTLOOP NOOPTALIAS OPTPEEP\
OPTRDEPTH=5 OPTDEPTH=5 OPTCOMPLEXITY=8\
NOOPTINLOCAL
#OPTINLOCAL

C_COMPILER_OPTS = PARAMS=r NOCHECKABORT NOSTACKCHECK NOSTACKEXTEND STRINGMERGE\
COMMENTNEST IDLEN=128 IGNORE=315 IGNORE=317 $(C_OPTIMIZE)


# Assembler
ASSEMBLER = a68k
ASSEMBLER_OPTS = -iNDK:Include_i

# Linker
LINKER = slink
LINKER_OPTS = NOICONS
#SC SD ND

# Objects
OBJECTS = libent.o libinit.o endcode.o init.o utils.o alloc.o loc.o maketables.o study.o get.o dispatch.o pcrerx.o pcre.o

# Libs
LIBS = sc:lib/sc.lib LIB:amiga.lib LIB:rxtoolkit.lib LIB:debug.lib

# Built file
$(TARGET): $(OBJECTS) $(LIBS)
        $(LINKER) <with <
FROM $(OBJECTS) TO $(TARGET) LIB $(LIBS) $(LINKER_OPTS)
<
        avail flush

# Rules
.c.o:
      $(C_COMPILER) $*.c $(C_COMPILER_OPTS)

.asm.o:
      $(ASSEMBLER) $(ASSEMBLER_OPTS) $*.asm

clean:
      -delete $(OBJECTS) $(TARGET)

install:
      copy $(TARGET) /SDK/Libs/

help:
      @echo "Available targets:"
      @echo "  all      - Build pcre.library"
      @echo "  clean    - Remove object files and executable"
      @echo "  install  - Install pcre.library to LIBS:"
      @echo "  help     - Show this help message"

# Dependences
libent.o:       libent.asm pcre.library_rev.i
libinit.o:      libinit.c lib.h pcre.library_rev.h loc.h base.h internal.h lib_protos.h macros.h config.h pcre.h
endcode.o:      endcode.asm
init.o:         init.c lib.h loc.h base.h internal.h lib_protos.h macros.h config.h pcre.h
utils.o:        utils.c lib.h loc.h base.h internal.h lib_protos.h macros.h config.h pcre.h
alloc.o:        alloc.c lib.h loc.h base.h internal.h lib_protos.h macros.h config.h pcre.h
pcre.o:         pcre.c lib.h internal.h loc.h base.h internal.h lib_protos.h config.h pcre.h
study.o:        study.c lib.h internal.h loc.h base.h internal.h lib_protos.h config.h pcre.h macros.h config.h pcre.h
maketables.o:   maketables.c lib.h internal.h loc.h base.h internal.h lib_protos.h config.h pcre.h macros.h config.h pcre.h
ucp.o:          ucp.c
get.o:          get.c lib.h internal.h loc.h base.h internal.h lib_protos.h config.h pcre.h macros.h config.h pcre.h
dispatch.o:     dispatch.c lib.h funlist.h loc.h base.h internal.h lib_protos.h macros.h config.h pcre.h
pcrerx.o:       pcrerx.c lib.h loc.h base.h internal.h lib_protos.h macros.h config.h pcre.h
loc.o:          loc.c lib.h loc.h base.h internal.h lib_protos.h macros.h config.h pcre.h
